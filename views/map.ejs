<!-- Toggle: kaart <-> tabel -->
<div class="view-toggle">
  <label class="switch">
    <input id="toggleView" type="checkbox" />
    <span class="switch__slider"></span>
  </label>
  <span id="toggleText">Show table</span>
</div>

<!-- MAP VIEW -->
<div id="mapView" class="view is-active">
  <div class="map-wrapper">
    <div class="kumasi-map"></div>

    <div id="interactiveLegend" class="interactive-legend">
      <div class="legend-compact">
        <span class="legend-val">0</span>
        <div class="gradient-bar"></div>
        <span class="legend-val">> 80</span>
        <div class="legend-tooltip">Info</div>
      </div>

      <div class="legend-expanded">
        <div class="legend-header">
          <p>NO₂ (µg/m³)</p>
          <span class="close-btn">&times;</span>
        </div>
        <div class="legend-row">
          <span class="dot" style="background: #59b61f"></span> 0 – 10
        </div>
        <div class="legend-row">
          <span class="dot" style="background: #a3bf29"></span> 10 – 20
        </div>
        <div class="legend-row">
          <span class="dot" style="background: #eec732"></span> 20 – 30
        </div>
        <div class="legend-row">
          <span class="dot" style="background: #ecaa33"></span> 30 – 40
        </div>
        <div class="legend-row">
          <span class="dot" style="background: #ea8c34"></span> 40 – 50
        </div>
        <div class="legend-row">
          <span class="dot" style="background: #da5634"></span> 50 – 60
        </div>
        <div class="legend-row">
          <span class="dot" style="background: #c92033"></span> 60 – 70
        </div>
        <div class="legend-row">
          <span class="dot" style="background: #8f3f97"></span> 70 – 80
        </div>
        <div class="legend-row">
          <span class="dot" style="background: #7e0023"></span> > 80
        </div>
      </div>
    </div>

    <div class="slider-container">
      <p class="slider-loading">Loading data...</p>
    </div>
  </div>
</div>

<div id="detailsOverlay" class="details-overlay"></div>

<div id="comparisonDock" class="comparison-dock">
  <span id="comparisonCount">0 locations selected</span>
  <div class="dock-buttons">
    <button onclick="window.clearComparison()" class="btn btn--ghost">
      Clear
    </button>
    <button onclick="window.showComparison()" class="btn">Compare</button>
  </div>
</div>

<div id="compareModal" class="compare-modal">
  <div class="compare-content">
    <div class="compare-header">
      <h2>Comparison</h2>
      <button onclick="window.closeComparison()" class="modal-close-btn">
        &times;
      </button>
    </div>

    <div id="compareGrid" class="compare-grid"></div>
  </div>
</div>

<!-- TABLE VIEW -->
<div id="tableView" class="view">
  <div class="table-filters">
    <label class="field">
      <span class="field__label">Period</span>
      <select id="periodFilter" class="input">
        <option value="">All</option>
      </select>
    </label>

    <label class="field">
      <span class="field__label">Search</span>
      <input
        id="qFilter"
        class="input"
        type="text"
        placeholder="Location ID or name"
      />
    </label>

    <label class="field">
      <span class="field__label">Min NO₂</span>
      <input
        id="minNo2"
        class="input"
        type="number"
        step="0.1"
        placeholder="10"
      />
    </label>

    <label class="field">
      <span class="field__label">Max NO₂</span>
      <input
        id="maxNo2"
        class="input"
        type="number"
        step="0.1"
        placeholder="40"
      />
    </label>

    <label class="checkbox">
      <input id="hideNoData" type="checkbox" />
      Hide “No data”
    </label>

    <button id="resetFilters" class="btn btn--ghost" type="button">
      Reset
    </button>
  </div>

  <div class="table-wrap">
    <table class="data-table">
      <thead>
        <tr>
          <th>Location ID</th>
          <th>Name</th>
          <th>Period</th>
          <th>NO₂</th>
        </tr>
      </thead>
      <tbody id="tableBody">
        <tr>
          <td colspan="4">Loading…</td>
        </tr>
      </tbody>
    </table>
  </div>

  <script>
    // ----------------------------
    // View toggle: map <-> table
    // ----------------------------
    const toggle = document.getElementById("toggleView");
    const toggleText = document.getElementById("toggleText");
    const mapView = document.getElementById("mapView");
    const tableView = document.getElementById("tableView");

    function setView(showTable) {
      if (showTable) {
        mapView.classList.remove("is-active");
        tableView.classList.add("is-active");
        toggleText.textContent = "Show map";
      } else {
        tableView.classList.remove("is-active");
        mapView.classList.add("is-active");
        toggleText.textContent = "Show table";

        // Leaflet needs this when container was hidden
        if (window.__leafletMap && window.__leafletMap.invalidateSize) {
          setTimeout(() => window.__leafletMap.invalidateSize(), 150);
        }
      }
    }

    toggle.addEventListener("change", () => setView(toggle.checked));
    setView(false);
  </script>

  <script src="/js/map.js"></script>
</div>
